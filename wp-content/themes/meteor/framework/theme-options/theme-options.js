(function(e){function m(){n.delegate("a#add-color-theme","click",function(t){var n=this.__self||(this.__self=e(this)),r=prompt("Name");r&&(r=e.trim(r),r.length&&e.post("admin-ajax.php?action=theme_options_misc",{context:"add-color-theme",name:r},function(e){if(e.success){var t=n.parents(".option-select").eq(0).find("select");t.find("[selected]").removeAttr("selected"),t.append('<option value="'+e.data.id+'" selected="selected">'+e.data.name+"</option>"),T(null,!0)}else e.error&&alert(e.error)},"json"))}),n.delegate("a#delete-color-theme","click",function(t){var n=this.__self||(this.__self=e(this)),r=n.parents(".option-select").eq(0).find("select"),i=r.find("option:selected"),s=i.attr("value");s==="default"?alert("The default color theme can't be deleted."):confirm('About to remove "'+i.text()+'". Proceed ?')&&e.post("admin-ajax.php?action=theme_options_misc",{context:"delete-color-theme",id:s},function(e){e.success?(r.find("[selected]").removeAttr("selected"),r.find('option[value="default"]').attr("selected","selected"),i.remove(),T(null,!0)):e.error&&alert(e.error)},"json")}),n.delegate("a#rename-color-theme","click",function(t){var n=this.__self||(this.__self=e(this)),r=n.parents(".option-select").eq(0).find("select"),i=r.find("option:selected"),s=i.attr("value");if(s==="default")alert("The default color theme can't be renamed.");else{var o=prompt('New Name for "'+i.text()+'":');o&&(o=e.trim(o),o.length&&o!==i.html()&&e.post("admin-ajax.php?action=theme_options_misc",{context:"rename-color-theme",id:s,name:o},function(e){e.success?(i.html(e.data.name),i.attr("value",e.data.id),T(null,!0)):e.error&&alert(e.error)},"json"))}})}function g(){for(var t,n,r,i=[],s=0;s<l.length;s++)n=l.eq(s),t=n.find("> h2.title"),r=t.data("icon"),r=r?'&nbsp;&nbsp; <i class="'+r+'" style="opacity: 0.7;"></i>':"",n.attr("id")===p||s===0&&p==null?(n.addClass("active"),i.push('<li class="active"><a href="#'+n.attr("id")+'">'+t.html()+r+"</a></li>")):i.push('<li><a href="#'+n.attr("id")+'">'+t.text()+r+"</a></li>");c.append(i.join("\n")),c.find("> li").click(function(t){var n=this.__self||(this.__self=e(this)),r=this.__target||(this.__target=e(n.find("a").attr("href")));r.hasClass("active")||(r.add(n).addClass("active").siblings(".active").removeClass("active"),wpCookies.set(h,r.attr("id"),2592e3,userSettings.url)),t.preventDefault()});try{S()}catch(o){}}function y(){var t=!1;o.delegate("a.update-webfonts-link","click",function(n){var r=parseInt(o.find("strong.webfonts-count").html(),10);if(t)alert("The fonts database has already been updated.");else{var i=this.__self||(this.__self=e(this)),s=i.attr("href");e.getJSON(s,function(e){e&&typeof e=="object"&&e.kind=="webfonts#webfontList"?(e.items.length==r?alert("No new fonts available."):alert("Got "+e.items.length+" fonts. Refresh to update."),t=!0):alert("Unable to obtain udpate information. Please try again later")})}n.preventDefault()});var n=o.find("select.update-fonts");if(n.length){var r=document.WP_THEME_URI+"/framework/webfonts/webfonts.json.txt";e.getJSON(r,function(t){if(t&&typeof t=="object"){o.find("strong.webfonts-count").html(t.items.length);var r=t.items,i=[],u={},a=/\s+/g,f=/^\d+$/;for(var l,c=r.length,h=0;h<c;h++)l=r[h].family,u[l]=r[h],i.push('<option value="'+l+'">'+l+"</option>");var p=e('<ul class="pick-list"></ul>');i=i.join("\n"),n.each(function(t,n){var r=this.__self||(this.__self=e(this)),l=r.data("active");r.html(i).find('option[value="'+l+'"]').attr("selected","selected");var c=r.parents(".option"),h=r.attr("id").replace(/^option\-/,""),p=r.attr("name").replace("["+h+"]","[{{ID}}]"),d=c.find("a.preview-font");d.length&&d.click(function(e){var t=r.find("option:selected").val().replace(a,"+");d.attr("href","http://www.google.com/webfonts/specimen/"+t)});var v={subsets:{},variants:{}};v.subsets.label=o.find(".option label[for=option-"+h+"_subsets]"),v.subsets.saved=v.subsets.label.siblings("span.values").data("values"),v.subsets.parent=v.subsets.label.parent(),v.subsets.option=v.subsets.label.parents(".option"),v.variants.label=o.find(".option label[for=option-"+h+"_variants]"),v.variants.saved=v.variants.label.siblings("span.values").data("values"),v.variants.parent=v.variants.label.parent(),v.variants.option=v.variants.label.parents(".option");var m=e("head"),g=e('<p class="font-specimen"></p>'),y=e("<link href='http://fonts.googleapis.com/css?family="+l.replace(a,"+")+"' rel='stylesheet' type='text/css'>");r.after(g),g.before("<p><small>preview</small></p>"),y.appendTo(m),r.change(function(){var e=["subsets","variants"],t=r.find("option:selected").val();y.attr("href","http://fonts.googleapis.com/css?family="+t.replace(a,"+")),g.css("fontFamily",t).html(t);for(var n,i=0;i<e.length;i++){s=e[i],n=v[s];var o=u[t][s];n.label.siblings("p").remove();for(var l,c,d,m=0;m<o.length;m++)c=o[m],f.test(c)&&(c=parseInt(c,10)),l=p.replace("{{ID}}",h+"_"+s)+"[_"+c+"]",n.saved&&n.saved.indexOf("_"+c)>=0?d='<p><label style="font-weight: normal;"><input checked="checked" type="checkbox" name="'+l+'"> '+c+"</label></p>":d='<p><label style="font-weight: normal;"><input type="checkbox" name="'+l+'"> '+c+"</label></p>",n.parent.append(d)}}).trigger("change")})}})}}function b(){d=o.find("#ajaxload"),i.append('<input type="hidden" name="ajax" value="true" />'),a=e('<div id="ajax-notification" class="success"></div>'),u.append(a),y();var t,r=[],s=e("body");jwerty.key("cmd+z/ctrl+z",function(){if(r.length){var e=r.pop();e.input.val(e.color),e.box.css("background",e.color).ColorPickerSetColor(e.color)}});var f=o.find(".option-color input:text.color"),l,c,h=/^#([a-f0-9]{3}|[a-f0-9]{6})$/i;f.focus(function(){var t=this.__self||(this.__self=e(this));c=t.val()}).blur(l=function(){var t=this.__self||(this.__self=e(this)),n=e.trim(t.val());if(n){n[0]!="#"&&(n="#"+n),n=n.toLowerCase();if(h.test(n)){if(n.length==4){var r=n[1],i=n[2],s=n[3];n="#XXYYZZ".replace(/X/g,r).replace(/Y/g,i).replace(/Z/g,s)}t.val(n),t.data("colorBox").css("background",n).ColorPickerSetColor(n)}else c&&(t.val(c),t.data("colorBox").css("background",c).ColorPickerSetColor(n))}else if(c){var o=t.data("default-color");t.val(o),t.data("colorBox").css("background",o).ColorPickerSetColor(n)}c=null,focusedInput=null}).change(l),o.find(".option-color").each(function(n,i){var o,u=e(i),a=u.find("input.color"),f=a.val()||"transparent",l=a.next(".color-box");l.css("background",f),a.data("colorBox",l);var c=function(){o.hide(),s.unbind("keyup",h),s.css({"-webkit-user-select":"text","-moz-user-select":"text","-o-user-select":"text","user-select":"text"})},h=function(e){(e.keyCode==27||e.keyCode==13)&&c()};l.ColorPicker({color:f,onBeforeShow:function(n){o||(o=e(n),o.data("input:color",a),o.data("color:box",l),a.data("colorPicker",o)),t=o,r.push({color:a.val(),input:a,box:l}),l.addClass("focused"),s.keyup(h),s.css({"-webkit-user-select":"none","-moz-user-select":"none","-o-user-select":"none","user-select":"none"})},onChange:function(e,t,n){t="#"+t,a.val(t),l.css("background",t)},onHide:function(){l.removeClass("focused"),s.css({"-webkit-user-select":"text","-moz-user-select":"text","-o-user-select":"text","user-select":"text"})},onSubmit:c})});var p,m=window.send_to_editor;n.find(".option input[type=text].upload-image-input").each(p=function(t,n){var r,i,s,o=e(n),u=o.val();u.length===0?o.parents("p").after('<p><a class="upload-image-link">'+v.uploadImage+'</a><a class="remove-image-link" style="display: none;">'+v.removeImage+"</a></p>"):o.parents("p").after('<p><a class="upload-image-link" style="display: none;">'+v.uploadImage+'</a><a class="remove-image-link">'+v.removeImage+"</a></p>"),r=o.parents(".option").find("a.upload-image-link"),i=o.parents(".option").find("a.remove-image-link"),s=o.parents(".option").find("a.image-thumbnail"),r.data("otherLink",i),i.data("otherLink",r),r.get(0).__self=r,i.get(0).__self=i,o.data("uploadImageLink",r),o.data("removeImageLink",i),o.data("imageThumbnail",s),o.on("change",function(e){o.val()===""?(E(o,s),o.data("uploadImageLink").show().data("otherLink").hide()):(w(o,s),o.data("removeImageLink").show().data("otherLink").hide())}),e.trim(o.val()).length>0&&w(o,s),r.data("callback",function(t){var n=e(t).attr("href");o.val(n).trigger("change"),window.send_to_editor=m,tb_remove(),r.hide().data("otherLink").show(),T(null,!0)}),i.data("input",o)}),n.delegate(".option a.upload-image-link","click",function(e){var t=this.__self;window.send_to_editor=t.data("callback"),tb_show("","media-upload.php?label=chooseThisImage&amp;type=image&amp;TB_iframe=true"),e.preventDefault()}),n.delegate(".option a.remove-image-link","click",function(e){var t=this.__self;t.data("input").val("").trigger("change"),t.hide().data("otherLink").show(),T(null,!0),e.preventDefault()}),n.delegate("#theme-options textarea","keydown",function(e){e.keyCode==9&&e.preventDefault()}),n.delegate("textarea.code-entry","focus",function(){var t=this.__self||(this.__self=e(this));t.data("width")||t.data("width",t.width()),t.width(537)}),n.delegate("textarea.code-entry","blur",function(){var e=this.__self;e.width(e.data("width"))}),o.find("#bottom-bar a.btn.reset-settings").removeAttr("href"),i.find("input:submit").click(T),i.find("a.btn.reset-settings").click(N),jwerty.key("cmd+s/ctrl+s",T),jwerty.key("ctrl+alt+r",N)}function w(e,t){var n=e.val();t.attr("href",n).find("img").attr("src",n),t.show()}function E(e,t){t.hide().removeAttr("href").find("img").removeAttr("src")}function S(){var e=window.location+"",t=e.lastIndexOf("#");if(t>=0){var n="#section-"+e.slice(t+1);o.find("#sections ul.sections-list li a[href="+n+"]").parent().trigger("click")}}function x(e,t){var n=a.height()+40+6,r=f.height(),i=f.scrollTop();o.find("input:text.upload-image-input").trigger("change"),a.html(e).stop().fadeIn(150,function(){setTimeout(function(){a.fadeOut(100)},700)})}function T(t,r,s){var o=i.serializeArray();d.css("visibility","visible"),n.trigger("theme-options:before-save",[o]);var u=function(){d.css("visibility","hidden"),r!==!0&&x(v.savedSettings),s instanceof Function&&s()};e.post(i.attr("action"),i.serialize(),function(t){if(t&&typeof t=="string"&&e.trim(t)==="success")u();else if(/^success:(.+)$/.test(t)===!0){var r="theme-options:"+t.split("success:")[1];n.trigger(r,[o,u])}else typeof window.console=="object"?console.log(t):alert(t)}),t&&typeof t=="object"&&t.preventDefault instanceof Function&&t.preventDefault()}function N(t){confirm(v.resetSettingsMessage)&&(i.append('<input type="hidden" name="reset-settings" value="true" />'),e.post(i.attr("action"),i.serialize(),function(t){if(t&&typeof t=="string"&&e.trim(t)==="success"){var n=i.find("input[name=_wp_http_referer]").attr("value");window.location=n}else typeof window.console=="object"?console.log(t):alert(t)})),t.preventDefault()}var t,n=e(document),r=!0,i,s,o,u,a,f,l,c,h,p="",d,v=document.WP_I18N_COMMON;n.ready(function(){i=e("#options-form"),i.length&&(o=e("#theme-options"),o.find("#content").addClass("js"),l=o.find("#content .section"),s=i.find("input:hidden[name=options-context]").attr("value"),h=document.WP_THEME_ID+"_"+s+"_tab",c=o.find("#sections ul.sections-list"),u=e("#wpwrap"),f=e(window),p=wpCookies.get(h),p&&e("#"+p).length===0&&(wpCookies.remove(h),p=null),g(),m(),b())})})(jQuery);